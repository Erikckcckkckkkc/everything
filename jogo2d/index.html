<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Jogo de Carrinho</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #222;
    }

    canvas {
      display: block;
      margin: auto;
      background: #444;
      border: 2px solid #fff;
    }
  </style>
</head>
<body>
  <audio id="myAudio" src='mySound.mp3'></audio>
  <audio loop id="music" src='music.mp3'></audio>
  <canvas id="gameCanvas" width="400" height="600"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const roadWidth = canvas.width;
    const carWidth = 40;
    const carHeight = 60;
    let carX = roadWidth / 2 - carWidth / 2;
    const carY = canvas.height - carHeight - 10;

    let obstacles = [];
    let score = 0;
    let gameOver = false;

    function drawCar() {
      ctx.fillStyle = "#00ff00";
      ctx.fillRect(carX, carY, carWidth, carHeight);
    }

    function drawObstacle(ob) {
      ctx.fillStyle = "#ff0000";
      ctx.fillRect(ob.x, ob.y, ob.width, ob.height);
    }

    function createObstacle() {
      const width = 40;
      const height = 60;
      const x = Math.random() * (roadWidth - width);
      obstacles.push({ x, y: -height, width, height });
    }

    function updateObstacles() {
      for (let ob of obstacles) {
        ob.y += 5 + Math.floor(score/100)/10;
        if (
          ob.y + ob.height > carY &&
          ob.y < carY + carHeight &&
          ob.x + ob.width > carX &&
          ob.x < carX + carWidth
        ) {
          gameOver = true;
        }
      }
      obstacles = obstacles.filter(ob => ob.y < canvas.height);
    }

    function drawScore() {
      ctx.fillStyle = "#fff";
      ctx.font = "20px Arial";
      ctx.fillText("Score: " + (Math.floor(score/100)) * 100, 10, 30);
    }

    function gameLoop() {
      if (gameOver) {
        ctx.fillStyle = "#fff";
        ctx.font = "40px Arial";
        ctx.fillText("Game Over", 100, canvas.height / 2);
        music.pause()
        return;
      }

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawCar();
      for (let ob of obstacles) drawObstacle(ob);
      drawScore();
      updateObstacles();

      score++;

      requestAnimationFrame(gameLoop);
    }

    function spawnObstacleLoop() {
        const delay = Math.max(200, 1000 - Math.floor(score / 100) * 50); // minimum 200ms
        createObstacle();
        setTimeout(spawnObstacleLoop, delay);
    }

    spawnObstacleLoop();

    document.addEventListener("keydown", e => {
      if (e.key === "ArrowLeft" && carX > 0) carX -= 20;
      if (e.key === "ArrowRight" && carX < roadWidth - carWidth) carX += 20;
    });

    gameLoop();

    const music = document.getElementById('music');
    music.play();
    
    document.addEventListener("keydown", e => {
      if (e.key === "b") {
        const audio = document.getElementById('myAudio');
        audio.currentTime = 0;
        audio.play();
      }
    });
  </script>
</body>
</html>
