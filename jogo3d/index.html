<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Jogo de Carrinho 3D</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; }
    #score {
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      font-family: Arial;
      font-size: 20px;
    }
  </style>
</head>
<body>
  <audio id="myAudio" src="mySound.mp3"></audio>
  <audio autoplay loop id="music" src='music.mp3'></audio>
  <div id="score">Score: 0</div>
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
  <script>
    const renderer = new THREE.WebGLRenderer();
  function startGame() {
    if (document.getElementById('points')) {document.getElementById('points').remove();}
    const container = document.getElementById("gameContainer");
    if (!container) return;
    
    const scene = new THREE.Scene();
    scene.background = new THREE.Color( 0x2465ec );
    renderer.setSize(container.clientWidth, container.clientHeight);
    container.appendChild(renderer.domElement);
    const camera = new THREE.PerspectiveCamera(
      75,
      container.clientWidth / container.clientHeight,
      0.1,
      1000
    );
    
    const light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(0, 1, 1).normalize();
    scene.add(light);
    
    const groundGeometry = new THREE.PlaneGeometry(500, 100);
    const groundMaterial = new THREE.MeshBasicMaterial({ color: 0xffe600 });
    const ground = new THREE.Mesh(groundGeometry, groundMaterial);
    ground.rotation.x = -Math.PI / 2;
    ground.position.z = -50;
    ground.position.y = -1;
    scene.add(ground);
    
    const roadGeometry = new THREE.PlaneGeometry(10, 100);
    const roadMaterial = new THREE.MeshBasicMaterial({ color: 0x444444 });
    const road = new THREE.Mesh(roadGeometry, roadMaterial);
    road.rotation.x = -Math.PI / 2;
    road.position.z = -50;
    scene.add(road);
    
    const roadLineGeometry = new THREE.PlaneGeometry(0.2, 2);
    const roadLineMaterial = new THREE.MeshBasicMaterial({ color: 0xfcfc00 });
    const roadLine = new THREE.Mesh(roadLineGeometry, roadLineMaterial);
    roadLine.rotation.x = -Math.PI / 2;
    roadLine.position.y = 0.01;
    
    const cactusGeometry = new THREE.PlaneGeometry(1, 3);
    const cactusMaterial = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
    const cactus = new THREE.Mesh(cactusGeometry, cactusMaterial);
    cactus.position.x = 8;
    cactus.position.y = 0.01;

    const obstacles = [];
    const obstacleGeometry = new THREE.BoxGeometry(1, 1, 2);
    const obstacleMaterial = new THREE.MeshBasicMaterial({ color: 0xff0000 });

    function createObstacle() {
      const ob = new THREE.Mesh(obstacleGeometry, obstacleMaterial);
      ob.position.set((Math.floor(Math.random()*7))-3, 0.5, -100);
      scene.add(ob);
      obstacles.push(ob);
    }

    camera.position.y = 1.5;
    camera.position.z = 0;
    
    let score = 0;
    let gameOver = false;

    function animate() {
        if (gameOver) return;

        requestAnimationFrame(animate);
        score++;
        document.getElementById("scorer").innerText = "SCORE: " + Math.floor(score/100)*100;

        for (let i = obstacles.length - 1; i >= 0; i--) {
            const ob = obstacles[i];
            ob.position.z += 0.5 + Math.floor(score / 100) / 100 + test / 5;

            if (ob.position.z > 0 && Math.abs(ob.position.x - camera.position.x) < 1) {
              gameOver = true;
              startTyping('you got a score of ' + Math.floor(score / 100) * 100 + '!!!!!');
              document.getElementById('music').pause();
              renderer.domElement.remove();
              container.innerHTML = `<h1 id='points'>you got a score of ${Math.floor(score / 100) * 100}!!!!!</h1>`
            }

            if (ob.position.z > 0) {
              scene.remove(ob);
              obstacles.splice(i, 1);
            }
            
        }

        renderer.render(scene, camera);
    }

    function spawnLoop() {
      if (!gameOver) {
        createObstacle();
        setTimeout(spawnLoop, Math.max(200, 1500 - Math.floor(score / 50) * (Math.floor(Math.random() * 10) + 1) - test * 300));
      }
    };
    
    function roadLineLoop() {
      if (gameOver) return;
    
      const line = roadLine.clone();
      line.position.z = -100;
      scene.add(line);
    
      const moveLine = () => {
        if (line.position.z <= 0) {
          line.position.z += 0.7 + Math.floor(score / 100) / 100 + test / 5;
          requestAnimationFrame(moveLine);
        } else {
          scene.remove(line);
        }
      };
    
      moveLine();
    
      setTimeout(roadLineLoop, 200 - test * 30);
    }
    
    function cactusLoop() {
      if (gameOver) return;
    
      const cac = cactus.clone();
      cac.position.z = -100;
      scene.add(cac);
      cac.position.x = Math.floor(Math.random() * 50 - 25)
      if ([-3, -2, -1, 0, 1, 2, 3].includes(cac.position.x)) {scene.remove(cac)}
    
      const moveCac = () => {
        if (cac.position.z <= 0) {
          cac.position.z += 0.7 + Math.floor(score / 100) / 100 + test / 5;
          requestAnimationFrame(moveCac);
        } else {
          scene.remove(cac);
        }
      };
    
      moveCac();
    
      setTimeout(cactusLoop, Math.floor(Math.random() * 20) * 500 - test * 30);
    }
  
    const keys = {
      ArrowLeft: false,
      ArrowRight: false,
      ArrowUp: false
    };
    
    document.addEventListener('keydown', e => {
        if (e.key in keys) keys[e.key] = true;
    });
    
    document.addEventListener('keyup', e => {
        if (e.key in keys) keys[e.key] = false;
    });

    document.addEventListener("keydown", e => {
      if (e.key === "b") {
        const audio = document.getElementById('myAudio');
        audio.currentTime = 0;
        audio.play();
      }
    });
    
    let lastMoveTime = 0;
    let test = 0;
    function update(timestamp) {
      if (timestamp - lastMoveTime > 50) {
          
        if (keys.ArrowLeft) {
          if (camera.position.x > -3) {camera.position.x -= 1};
        }
          
        if (keys.ArrowRight) {
          if (camera.position.x < 3) {camera.position.x += 1};
        }
        
        if (keys.ArrowUp) {test = 2; score += 2;} else {test = 0};
          
        lastMoveTime = timestamp;
      }
      
      requestAnimationFrame(update);
    }
      
    requestAnimationFrame(update);
    
    update();
    animate();
    spawnLoop();
    roadLineLoop();
    cactusLoop();
  };
  </script>
</body>
</html>
